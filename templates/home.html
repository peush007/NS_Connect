{% extends "base.html" %}

{% block content %}
<!-- Hero Section -->
<section class="hero container">
    <h1 class="hero-title">
        Find Trusted Local Services<br>
        <span style="color: var(--text-primary); font-size: 2.5rem; font-weight: 600;">in Seconds</span>
    </h1>
    <p class="hero-subtitle">
        From plumbers to electricians, connect with top-rated professionals nearby.
        Reliable, fast, and verified.
    </p>

    <div class="card" style="max-width: 800px; margin: 0 auto; padding: 2rem; border-color: var(--primary-color);">
        <form action="{% url 'service_search' %}" method="get" class="grid"
            style="grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">

            <div style="text-align: left;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">What do you
                    need?</label>
                <select name="category" class="form-control"
                    style="width: 100%; padding: 0.75rem; border-radius: var(--radius-md); border: 1px solid var(--border-color); background: var(--background-color); color: var(--text-primary);">
                    <option value="">All Categories</option>
                    {% for service in services %}
                    <option value="{{ service.id }}">{{ service.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="text-align: left;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Radius
                    (km)</label>
                <input type="number" name="radius" value="50"
                    style="width: 100%; padding: 0.75rem; border-radius: var(--radius-md); border: 1px solid var(--border-color); background: var(--background-color); color: var(--text-primary);">
            </div>

            <div style="text-align: left;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Your
                    Location</label>
                <div class="flex gap-4">
                    <input type="text" name="lat" id="lat" placeholder="Lat"
                        style="width: 100%; padding: 0.75rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);"
                        readonly>
                    <input type="text" name="lon" id="lon" placeholder="Lon"
                        style="width: 100%; padding: 0.75rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);"
                        readonly>
                </div>
            </div>

            <div style="display: flex; gap: 0.5rem;">
                <button type="button" onclick="getLocation()" class="btn btn-outline" title="Use my location"
                    style="aspect-ratio: 1; padding: 0 1rem;">
                    üìç
                </button>
                <button type="submit" class="btn btn-primary" style="height: 48px; white-space: nowrap;">
                    Search
                </button>
            </div>
        </form>

        <!-- Leaflet Map for Location Picker -->
        <div id="location-map"
            style="height: 200px; margin-top: 1rem; border-radius: var(--radius-md); overflow: hidden; border: 1px solid var(--border-color);">
        </div>
        <div id="loc-status" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--success-color);"></div>
    </div>
</section>

<!-- Categories Preview -->
<section style="background-color: white; padding: 4rem 0; border-top: 1px solid var(--border-color);">
    <div class="container">
        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem; text-align: center;">Popular Services</h2>

        <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem;">
            {% for service in services|slice:":6" %}
            <a href="{% url 'service_search' %}?category={{ service.id }}" class="card"
                style="text-align: center; text-decoration: none;">
                <div
                    style="width: 60px; height: 60px; background: #eff6ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.5rem;">
                    üîß <!-- Placeholder Icon -->
                </div>
                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">
                    {{ service.name }}
                </h3>
                <p style="color: var(--text-secondary); font-size: 0.875rem;">
                    {{ service.description|truncatewords:10 }}
                </p>
            </a>
            {% endfor %}
        </div>

        <div style="text-align: center; margin-top: 3rem;">
            <a href="{% url 'service_search' %}" class="btn btn-outline">Browse All Services</a>
        </div>
    </div>
    </div>
</section>

<!-- Provider Call to Action -->
<section style="padding: 4rem 0; background-color: var(--background-color);">
    <div class="container text-center">
        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem;">Are you a Service Professional?</h2>
        <p
            style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
            Join our platform to reach more customers in your local area. Create your profile, showcase your skills, and
            grow your business today.
        </p>
        <a href="{% url 'register_provider' %}" class="btn btn-primary"
            style="padding: 0.75rem 2rem; font-size: 1.1rem;">Become a Provider</a>
    </div>
</section>

<script>
    let map, marker;

    // Initialize Leaflet Map
    document.addEventListener('DOMContentLoaded', function () {
        map = L.map('location-map').setView([20.5937, 78.9629], 4); // Default: India center
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // Click on map to set location
        map.on('click', function (e) {
            setMarker(e.latlng.lat, e.latlng.lng);
        });
    });

    function setMarker(lat, lng) {
        if (marker) map.removeLayer(marker);
        marker = L.marker([lat, lng]).addTo(map);
        document.getElementById('lat').value = lat.toFixed(4);
        document.getElementById('lon').value = lng.toFixed(4);
        document.getElementById('loc-status').innerHTML = 'Location set from map!';
        document.getElementById('loc-status').style.color = 'var(--success-color)';
    }

    function getLocation() {
        const x = document.getElementById("loc-status");
        if (navigator.geolocation) {
            x.innerHTML = "Locating...";
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        setMarker(lat, lng);
        map.setView([lat, lng], 12);
        document.getElementById("loc-status").innerHTML = "Location detected!";
    }

    function showError(error) {
        const x = document.getElementById("loc-status");
        x.style.color = "var(--danger-color)";
        switch (error.code) {
            case error.PERMISSION_DENIED:
                x.innerHTML = "Location permission denied.";
                break;
            default:
                x.innerHTML = "Location error.";
        }
    }
</script>
{% endblock %}